<!DOCTYPE html>
<html><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="map[]">
    <meta name="generator" content="Hugo 0.55.2" />
    <title>noone.dev</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Oxygen+Mono">
    <link rel="stylesheet" href="/fontawesome-free-5.7.2/css/all.min.css">
    
    <link rel="stylesheet" href="/scss/main.min.eb5f6698e9eef38a204f38a27f3631ace5720b7526fb244b4d3828ca090437c6.css">
</head>
<body><nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
    <a class="navbar-brand" href="/">$HOME</a>
    
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse"
        aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarCollapse">
        <ul class="navbar-nav ml-auto">
            
            
            <li class="nav-item">
                <a class="nav-link" href="/about/">~/about</a>
            </li>
            
            
            
            <li class="nav-item">
                <a class="nav-link" href="/posts/">~/posts</a>
            </li>
            
            
        </ul>
    </div>
</nav><div id="content" class="container">
<h5>Jun 07  2012 <a href="/2012/06/07/show-svn-revision-number-in-a-rails-application/">Show SVN revision number in a Rails application</a></h5>
<hr />
<div class="post-content">
    <p>This is a hack to display the Subversion revision in a Rails application using <a href="http://capify.org" title="Capistrano" target="_blank">Capistrano</a> to insert the current revision number on each deploy.</p>

<p>Create a partial that will contain the revision number. For example, _~/app/views/layouts/<em>revision.html.erb</em>. You can put anything in that file, as it will be overwritten by Capistrano on each deploy. The word &#8220;Development&#8221; or &#8220;Current&#8221; seems a good choice.</p>

<p>In the page where you want to display the revision number (probably in the application layout), render the partial. In development mode, you&#8217;ll see something like &#8220;version 1.0.Development&#8221;. In your deployment environment, you&#8217;ll see the SVN revision number, like so: &#8220;version 1.0.504&#8221;.</p>

<pre lang="ruby">version 1.0.&lt;%=render :partial => 'layouts/revision'%></pre>

<p>To set up Capistrano, edit the <em>~/config/deploy.rb</em> file (assuming you are already using Capistrano for deployments). Add a task to get the SVN version and write that to your revision partial. For some reason, pointing to the &#8220;/current&#8221; directory doesn&#8217;t work &#8211; probably because of the way Capistrano links directories. Therefore, just point SVN to any subdirectory or file to get the version.</p>

<pre lang="ruby">desc "Write current revision to app/layouts/_revision.rhtml"
task :publish_revision do
  run "svnversion #{deploy_to}/current/app > #{deploy_to}/current/app/views/layouts/_revision.html.erb"
end</pre>

<p>And tell Capistrano to run this task just before restarting the application:</p>

<pre lang="ruby">before 'deploy:restart', 'publish_revision'</pre>

</div>

    </div></body>
<script src="/jquery-3.3.1.slim/jquery.slim.min.js"></script>
<script src="/bootstrap-4.3.1/js/dist/util.js"></script>
<script src="/bootstrap-4.3.1/js/dist/dropdown.js"></script>
<script src="/bootstrap-4.3.1/js/dist/collapse.js"></script>
</html>