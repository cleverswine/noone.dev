<!DOCTYPE html>
<html><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="map[]">
    <meta name="generator" content="Hugo 0.72.0" />
    <title>noone.dev</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css">
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
</head><body><nav class="navbar is-light" role="navigation" aria-label="main navigation">
    <div class="navbar-brand">
        <a class="navbar-item" href="/">
            <img src="/apple-touch-icon.png" width="32" height="32">&nbsp;&nbsp;<strong>noone.dev</strong>
        </a>
        
    </div>
</nav><section class="section">
        <div class="container">
<p class="title is-4"><a href="/2011/03/08/mvc3-mongodb-autofac/">MVC3 &#43; MongoDB &#43; Autofac</a></p>
<p class="subtitle is-6 has-text-grey"><i class="fas fa-calendar-alt" aria-hidden="true"></i> March 8, 2011</p>
<hr />
<div class="content">
    <p>I recently posted a <a href="http://blog.cleverswine.net/2011/03/08/a-diet-and-an-application/">brief summary</a> of creating a recipe database.  I decided to expand on that and go into the implementation details of using ASP.NET MVC3 with MongoDB and Autofac.  This code depends on the <a href="https://github.com/atheken/NoRM">NoRM</a> driver for <a href="http://www.mongodb.org/">MongoDB</a>, <a href="http://code.google.com/p/autofac/">Autofac</a>, and <a href="http://www.asp.net/mvc">MVC3</a> (and it’s dependencies). This is by no means the only (or best) way to do things, but this is how I chose to do it.  I’ve simplified the repository to one method for brevity, but you’d obviously want to add all of the required CRUD operations.</p>
<p>First, we’ll want to create an interface for our database session.  The implementation of this interface can be swapped out depending on the backing store.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>Add a MongoDB implementation of ISession.  This implementation will eventually be used in our repository.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>Create an interface for the repository.  This is what the controller will expect to be injected via it’s constructor.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>Add the IRecipeRepository implementation, which is created with a new()-able type of ISession.  Why didn’t I just inject an ISession into the repository?  It’s because Mongo sessions are expected to be disposed of after use, as connections are pooled and reused.  Therefore we have to create and dispose of our sessions when using them.  This might require some workarounds if you really did switch repositories (do nothing on Dispose(), etc).</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>Now it’s time set up our IoC container.  We’ll do this in the Global.asax.cs.  Here we are registering a recipe repository of type MongoSession such that any controller that expects an IRecipeRepository in the constructor will get this.  We’re letting Autofac handle controller creation and dependency injection.  See the <a href="http://code.google.com/p/autofac/wiki/Mvc3Integration">Autofac MVC3 integration page</a> for more details.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>Finally, here is our controller.  Notice we never have to create a repository object – one was injected for us.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>That’s it.</p>

</div>

        </div>
    </section><footer class="footer">
    <div class="content has-text-centered">
        <p>
            
                
                    <a style="margin-right: 8px;" href="https://github.com/cleverswine/" aria-label="Github"   >
                        <i class="fab fa-github fa-2x" aria-hidden="true"></i>
                    </a>
                
                    <a style="margin-right: 8px;" href="https://twitter.com/cleverswine/" aria-label="Twitter"   >
                        <i class="fab fa-twitter fa-2x" aria-hidden="true"></i>
                    </a>
                
                    <a style="margin-right: 8px;" href="https://www.linkedin.com/in/kevinnoone/" aria-label="LinkedIn"   >
                        <i class="fab fa-linkedin fa-2x" aria-hidden="true"></i>
                    </a>
                
                    <a style="margin-right: 8px;" href="http://www.flickr.com/photos/cleverswine/" aria-label="Flickr"   >
                        <i class="fab fa-flickr fa-2x" aria-hidden="true"></i>
                    </a>
                
                    <a style="margin-right: 8px;" href="http://noone.dev/index.xml" aria-label="RSS" rel="alternate"   type="application/rss&#43;xml" >
                        <i class="fas fa-rss fa-2x" aria-hidden="true"></i>
                    </a>
                
            
        </p>
        <p> © 2020 Kevin Noone · Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://bulma.io/">Bulma</a></p>
    </div>
</footer></body>

</html>